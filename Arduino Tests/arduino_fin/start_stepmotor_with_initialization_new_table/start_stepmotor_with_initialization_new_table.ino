#include <Stepper.h>
#include <Servo.h>

#define STEPS_PER_REVOLUTION 200
#define RESOLUTION 61

#define FAN1 37 //вентилятор верхний
#define LIGHT 35 //подсветка
#define VACUUM 33 //пылесос
#define SIRENA 13

#define INIT 0
#define WORK 1

#define s_begin Serial.begin
#define s_print Serial.print
#define s_is_av Serial.available
#define s_read  Serial.read
#define s_to_int Serial.parseInt

Servo servo; // серво для кусь

Stepper myStepper1(STEPS_PER_REVOLUTION, 44, 42, 40, 38); // двигатель поворотного основания
Stepper myStepper2(STEPS_PER_REVOLUTION, 52, 50, 48, 46); // большой двигатель вверх
Stepper myStepper3(STEPS_PER_REVOLUTION, 45, 43, 41, 39); // двигатель верхний пред кусь
Stepper myStepper4(STEPS_PER_REVOLUTION, 53, 51, 49, 47); // двигатель верхний на кусь

const int X[] = {620, 642, 378, 414, 340, 660, 604, 605, 623, 563, 682, 660, 672, 663, 596, 617, 552, 469, 599, 659, 366, 620, 645, 552, 625, 332, 673, 473, 683, 643, 595, 496, 681, 674, 626, 650, 592, 576, 424, 404, 541, 660, 526, 637, 644, 527, 616, 682, 351, 500, 672, 369, 508, 565, 467, 682, 455, 632, 662, 645, 598, 390, 559, 673, 630, 614, 673, 384, 681, 328, 661, 647, 522, 394, 661, 683, 660, 469, 538, 575, 644, 529, 462, 621, 407, 663, 576, 500, 503, 662, 645, 629, 477, 595, 650, 533, 645, 597, 418, 591, 638, 619, 490, 648, 647, 515, 444, 607, 625, 592, 589, 527, 673, 412, 621, 585, 674, 425, 386, 573, 450, 539, 673, 682, 624, 320, 535, 353, 563, 625, 471, 385, 500, 659, 642, 519, 431, 430, 629, 520, 582, 672, 450, 674, 645, 493, 646, 661, 673, 514, 683, 372, 488, 377, 536, 589, 391, 376, 661, 673, 621, 495, 626, 388, 663, 483, 673, 645, 557, 518, 509, 622, 360, 646, 585, 584, 649, 674, 597, 631, 593, 379, 664, 683, 448, 673, 663, 664, 681, 673, 681, 502, 646, 625, 428, 550, 673, 682, 674, 355, 659, 422, 659, 441, 643, 382, 674, 368, 554, 487, 431, 674, 397, 559, 681, 600, 622, 596, 609, 489, 579, 681, 411, 673, 565, 511, 460, 658, 338, 682, 603, 658, 630, 663, 569, 636, 682, 682, 683, 672, 470, 624, 538, 682, 597, 682, 674, 348, 622, 682, 673, 662, 648, 583, 626, 661, 624, 336, 590, 683, 673, 638, 682, 663, 389, 550, 619, 457, 494, 660, 612, 458, 648, 641, 673, 673, 640, 360, 674, 629, 585, 564, 683, 622, 596, 455, 340, 593, 327, 444, 504, 673, 514, 627, 564, 647, 620, 423, 345, 604, 443, 602, 644, 661, 681, 584, 408, 554, 657, 682, 659, 662, 625, 552, 649, 628, 439, 597, 342, 492, 453, 329, 346, 415, 590, 662, 368, 661, 553, 588, 673, 681, 587, 510, 485, 627, 682, 509, 649, 571, 641, 682, 682, 316, 672, 645, 646, 594, 497, 662, 598, 559, 506, 556, 629, 595, 681, 639, 664, 630, 674, 647, 615, 626, 398, 674, 486, 626, 601, 427, 485, 441, 540, 541, 367, 663, 613, 569, 619, 498, 682, 659, 674, 353, 651, 501, 363, 624, 650, 350, 459, 628, 673, 674, 596, 619, 438, 681, 591, 357, 646, 629, 658, 682, 623, 376, 661, 394, 682, 325, 621, 658, 682, 661, 683, 673, 502, 618, 611, 614, 661, 658, 370, 659, 456, 662, 568, 598, 682, 642, 674, 592, 623, 505, 449, 580, 661, 643, 662, 605, 662, 588, 621, 495, 461, 646, 682, 663, 603, 314, 663, 404, 322, 586, 556, 682, 640, 633, 674, 399, 641, 440, 507, 682, 640, 674, 479, 548, 595, 505, 673, 600, 549, 642, 392, 672, 511, 514, 683, 601, 302, 681, 429, 646, 624, 621, 323, 434, 643, 661, 673, 657, 673, 662, 530, 572, 673, 422, 673, 659, 683, 674, 497, 673, 568, 662, 623, 548, 434, 600, 682, 410, 674, 683, 682, 341, 662, 647, 681, 661, 673, 590, 631, 594, 682, 618, 432, 452, 683, 618, 612, 662, 682, 331, 370, 421, 352, 348, 639, 628, 642, 361, 683, 648, 647, 375, 646, 673, 590, 522, 663, 563, 313, 480, 638, 683, 543, 530, 602, 561, 660, 516, 673, 682, 562, 568, 673, 674, 468, 571, 641, 518, 566, 673, 682, 662, 674, 381, 606, 640, 452, 454, 505, 647, 622, 591, 642, 657, 359, 673, 537, 590, 476, 436, 620, 344, 539, 624, 674, 683, 511, 574, 643, 617, 661, 660, 663, 481, 673, 554, 389, 683, 465, 553, 674, 555, 603, 681, 446, 623, 597, 447, 434, 582, 660, 673, 673, 643, 601, 578, 513, 545, 627, 650, 660, 495, 560, 311, 513, 458, 512, 673, 673, 526, 644, 464, 599, 562, 663, 609, 555, 648, 557, 682, 403, 599, 682, 453, 382, 662, 534, 350, 646, 661, 673, 546, 577, 449, 547, 647, 615, 664, 620, 463, 466, 308, 674, 683, 682, 410, 587, 405, 433, 661, 682, 660, 681, 551, 663, 487, 644, 550, 482, 659, 592, 673, 672, 663, 557, 546, 682, 682, 478, 672, 334, 683, 507, 589, 622, 610, 673, 674, 420, 545, 615, 661, 520, 594, 674, 473, 674, 374, 587, 673, 579, 620, 544, 660, 660, 551, 337, 428, 644, 549, 560, 490, 648, 430, 566, 674, 682, 553, 662, 510, 641, 373, 659, 516, 437, 662, 402, 380, 649, 504, 525, 674, 643, 491, 649, 371, 416, 661, 682, 683, 306, 542, 488, 628, 644, 607, 570, 575, 616, 681, 613, 617, 682, 564, 592, 640, 673, 508, 365, 573, 395, 682, 335, 672, 649, 523, 548, 534, 517, 559, 524, 492, 642, 546, 662, 648, 544, 620, 661, 682, 323, 587, 356, 644, 406, 345, 616, 543, 460, 619, 673, 663, 662, 645, 497, 660, 507, 673, 659, 330, 419, 662, 645, 674, 499, 682, 660, 605, 471, 437, 558, 642, 477, 593, 647, 594, 672, 415, 662, 631, 547, 589, 644, 674, 673, 681, 426, 673, 617, 561, 618, 663, 517, 614, 364, 673, 627, 398, 297, 567, 363, 362, 625, 681, 673, 639, 649, 503, 373, 640, 674, 683, 528, 417, 648, 664, 542, 532, 483, 501, 586, 466, 358, 627, 673, 682, 443, 560, 602, 356, 397, 442, 673, 682, 354, 440, 681, 673, 673, 558, 519, 530, 645, 584, 447, 581, 446, 662, 599, 683, 628, 451, 682, 646, 661, 646, 521, 550, 626, 411, 475, 385, 534, 658, 561, 475, 512, 682, 683, 426, 498, 682, 681, 594, 562, 682, 682, 624, 623, 674, 480, 343, 598, 681, 582, 401, 673, 347, 643, 601, 581, 318, 436, 435, 339, 646, 625, 629, 682, 682, 643, 586, 566, 682, 588, 492, 556, 617, 682, 682, 494, 663, 424, 648, 673, 682, 674, 683, 333, 622, 596, 531, 545, 673, 555, 445, 583, 682, 683};
const int Y[] = {2, 30, -37, -158, -132, 105, 123, 136, 65, 29, 296, 87, 72, 234, 42, -26, -53, 29, 66, 69, -69, 13, 122, -47, 99, -151, 181, 47, 209, 44, 19, -97, 360, 226, 100, 247, -16, -138, -132, 36, -112, 112, 49, -57, 83, 52, -43, 270, -103, -78, 98, -60, -40, 46, 22, 327, -26, 208, 207, 132, 59, -5, 6, 163, 171, -57, 160, -20, 396, -156, 175, 174, 30, -213, 155, 111, 127, -201, -132, -148, 90, -180, 4, 41, -179, 248, 130, -71, -65, 236, 108, 158, -171, 32, 238, -157, 118, 49, -146, -5, -32, 2, -122, 181, 167, -2, -56, 150, 86, -2, -33, 58, 245, -161, 34, -63, 370, -126, -11, -161, -35, -122, 239, 303, 89, -176, -145, -100, 32, 93, 38, -17, -82, 62, 26, 20, -101, -111, 154, 23, -97, 76, -41, 237, 128, -109, 143, 173, 148, -6, 240, -51, -125, -34, -142, -40, 1, -37, 151, 142, 27, -100, 113, -8, 280, -146, 127, 94, -20, 8, -34, 55, -86, 126, -67, -77, 228, 315, 45, 185, 5, -31, 306, 126, -44, 173, 289, 327, 393, 209, 368, -62, 152, 90, -120, -60, 249, 273, 382, -98, 55, -135, 76, -68, 69, -25, 213, -57, -30, -128, -105, 306, 15, 0, 416, 79, 38, 29, -120, -129, -121, 377, -163, 152, 39, -24, -5, 25, -134, 280, 113, 51, 181, 250, 72, -71, 233, 290, 176, 123, 34, 79, -125, 243, 52, 300, 333, -108, 41, 342, 191, 183, 183, -84, 110, 162, 66, -137, -26, 264, 262, -46, 259, 271, -2, -56, -1, -17, -103, 84, -82, -14, 201, 19, 199, 266, 8, -77, 324, 152, -70, 36, 205, 48, 35, -20, -128, 2, -162, -63, -62, 170, -8, 120, 39, 180, 20, -128, -120, 119, -59, 106, 80, 127, 389, -81, -172, -33, 11, 229, 73, 214, 103, -43, 234, 138, -81, 43, -129, -106, -29, -160, -114, -152, -16, 187, -66, 148, -34, -46, 307, 401, -43, -28, -137, 130, 287, -37, 220, 85, 30, 236, 313, -184, 102, 111, 119, 18, -84, 213, 65, -7, -46, -11, 148, 28, 356, -28, 315, 175, 298, 170, -47, 117, -201, 260, -141, 104, 92, -117, -144, -72, -119, -116, -63, 244, -71, 78, -5, -87, 215, 87, 337, -97, 273, -75, -68, 75, 251, -106, -8, 134, 285, 293, 32, 6, -77, 352, -19, -86, 136, 161, 14, 338, 52, -40, 138, 9, 257, -165, 30, 40, 226, 116, 137, 272, -72, -15, -96, -68, 161, 36, -57, 66, -14, 221, 68, 53, 351, 48, 302, 5, 55, -59, -48, -111, 169, 51, 166, 133, 190, -43, 23, -104, 1, 146, 274, 276, 103, -187, 224, -184, -173, -67, -23, 316, 1, 221, 349, 24, 12, -78, -40, 326, -14, 311, -165, -73, 25, -50, 212, 76, -70, 37, 4, 61, -18, -15, 237, 80, -214, 372, -114, 156, 72, 16, -171, -99, 73, 134, 253, -15, 116, 223, 71, 95, 268, -131, 215, 80, 191, 340, -94, 201, 65, 193, 69, -66, -96, 83, 363, 56, 296, 226, 282, -126, 176, 164, 381, 165, 156, -29, 198, 12, 260, -22, -98, -32, 180, -12, -93, 230, 347, -148, -54, -137, -107, -112, -17, 128, 55, -80, 219, 187, 157, -46, 142, 149, -22, 33, 267, 26, -193, 71, -42, 151, -106, 74, 100, 16, 130, 1, 225, 297, 23, 62, 120, 358, 25, 91, 23, 11, 49, 219, 307, 211, 320, -28, 146, -3, -35, -23, -53, 154, 30, -12, 40, 0, -83, 174, -135, -19, -177, -90, 16, -127, -129, 83, 270, 140, -27, 108, 66, -37, 123, 95, 254, -156, 145, -37, -224, 184, 13, -40, 202, -20, 110, 413, -57, 62, 55, -47, -89, -94, 137, 167, 134, 58, 86, -124, -12, -93, 124, 260, 120, -93, 3, -195, -18, -11, -21, 243, 294, -192, 97, 7, 63, 16, 261, 172, -27, 193, -7, 249, -190, 73, 335, -26, -22, 199, -154, -109, 129, 185, 184, -90, -135, -38, -76, 166, -51, 293, 6, 10, 16, -204, 256, 250, 286, -170, -50, -181, -102, 141, 201, 109, 365, -50, 240, -134, 104, -53, -149, 91, -9, 276, 113, 238, -14, -79, 253, 310, -168, 87, -149, 169, -50, -29, 51, -107, 177, 289, -144, -86, -54, 145, 17, 8, 362, -189, 283, -43, -57, 281, -114, 27, -103, 113, 116, -57, -140, -110, 87, -63, 12, -115, 207, -107, 55, 345, 305, -43, 209, -31, 15, -49, 44, -5, -80, 203, 33, -25, 205, -56, 45, 274, 55, -119, 215, -48, -149, 159, 187, 198, -206, -109, -131, 144, 94, 159, 82, 117, -40, 436, -79, -29, 239, 42, -5, 5, 105, -37, -66, 104, 12, 322, -143, 91, 211, 36, -77, -147, 4, 3, 39, -116, 33, -83, 189, 177, -96, 9, 152, 162, -167, -53, -88, 69, 44, -117, -33, -99, -2, -8, 235, 263, 227, 105, -90, 102, -43, 205, 58, -154, -140, 197, 115, 247, -84, 329, 98, 127, -192, -84, -10, 44, 59, 8, 160, 15, 46, -155, 217, 194, -80, -36, 76, 280, 138, 376, -119, 221, -19, 19, -8, 284, 7, -65, -72, 198, 126, 21, -225, 59, -78, -74, 96, 405, 233, -21, 224, -59, -45, -6, 319, 223, 61, -143, 191, 302, -102, 83, -153, -68, -53, -213, -89, 114, 131, 267, -69, 9, 96, -92, -204, -65, 229, 277, -94, -75, 424, 223, 258, -4, 14, -170, 101, -74, -50, -101, -53, 201, 69, 212, 140, -38, 355, 133, 179, 140, 27, -67, 107, -167, -180, -14, 96, 29, 13, 50, -15, 284, 166, -123, -81, 294, 384, 22, 25, 247, 320, 76, 58, 250, -159, -123, 56, 340, -90, -192, 187, -118, 62, 90, -108, -182, -87, -93, -138, 150, 80, 167, 344, 309, 79, -60, 52, 263, -39, -112, -17, -22, 318, 212, -107, 257, -122, 197, 195, 331, 328, 194, -145, 44, 39, -167, -89, 188, -30, -60, -87, 333, 155};
const int R2[] = {33, 30, 47, 33, 37, 40, 57, 57, 53, 57, 53, 30, 33, 50, 57, 33, 33, 53, 47, 33, 43, 37, 50, 40, 60, 33, 40, 60, 33, 30, 40, 37, 53, 37, 47, 60, 33, 33, 30, 57, 40, 47, 57, 30, 47, 53, 37, 40, 43, 43, 37, 47, 43, 53, 60, 60, 47, 60, 50, 53, 53, 50, 53, 43, 57, 37, 33, 53, 53, 40, 53, 53, 50, 30, 47, 30, 47, 30, 33, 30, 40, 30, 53, 50, 30, 50, 60, 50, 43, 60, 50, 57, 37, 53, 57, 33, 53, 50, 33, 50, 33, 47, 37, 47, 47, 57, 53, 57, 47, 47, 37, 60, 57, 37, 43, 40, 60, 37, 57, 30, 57, 37, 50, 47, 57, 37, 33, 40, 53, 53, 57, 50, 33, 40, 33, 60, 50, 33, 60, 57, 33, 30, 50, 40, 57, 37, 43, 43, 43, 60, 30, 50, 40, 57, 30, 30, 57, 60, 50, 37, 37, 40, 60, 53, 57, 37, 37, 37, 40, 47, 50, 50, 37, 47, 43, 40, 53, 53, 53, 57, 40, 53, 57, 30, 53, 47, 60, 60, 57, 40, 57, 53, 60, 43, 30, 40, 53, 50, 60, 37, 33, 33, 40, 53, 47, 47, 37, 57, 50, 43, 40, 50, 53, 47, 57, 60, 40, 43, 30, 30, 30, 60, 40, 40, 47, 53, 50, 33, 40, 43, 53, 37, 60, 60, 53, 30, 37, 47, 37, 40, 60, 53, 40, 40, 60, 50, 60, 50, 37, 47, 43, 47, 57, 33, 50, 40, 40, 43, 43, 33, 53, 33, 50, 53, 60, 50, 37, 50, 43, 33, 33, 47, 53, 40, 37, 50, 37, 53, 57, 50, 33, 50, 37, 43, 50, 53, 47, 43, 33, 47, 40, 37, 50, 53, 60, 60, 43, 40, 37, 60, 57, 60, 37, 33, 60, 30, 37, 40, 33, 40, 30, 43, 57, 50, 60, 50, 40, 43, 33, 47, 50, 30, 43, 40, 47, 43, 40, 40, 53, 37, 60, 60, 47, 57, 40, 57, 37, 40, 60, 53, 43, 47, 50, 33, 33, 47, 40, 53, 50, 57, 60, 40, 50, 57, 53, 57, 57, 30, 60, 53, 57, 57, 40, 57, 30, 43, 30, 43, 60, 40, 33, 43, 33, 30, 50, 53, 37, 60, 40, 40, 40, 43, 57, 50, 60, 40, 57, 57, 57, 47, 53, 53, 57, 50, 40, 43, 50, 60, 37, 50, 50, 53, 30, 50, 40, 50, 37, 60, 40, 37, 47, 33, 43, 30, 33, 57, 37, 37, 33, 33, 53, 37, 43, 37, 60, 50, 57, 47, 50, 40, 53, 53, 37, 37, 43, 33, 47, 37, 37, 60, 40, 33, 40, 30, 57, 53, 37, 60, 50, 37, 47, 37, 33, 30, 43, 47, 30, 60, 57, 57, 33, 37, 57, 50, 30, 57, 30, 40, 47, 53, 50, 50, 37, 37, 53, 30, 60, 43, 33, 47, 30, 53, 37, 57, 47, 33, 30, 33, 43, 40, 50, 30, 33, 60, 60, 57, 60, 43, 47, 37, 37, 53, 33, 47, 60, 50, 50, 47, 43, 57, 50, 60, 47, 30, 53, 43, 40, 50, 57, 50, 37, 33, 57, 47, 37, 30, 47, 53, 33, 33, 30, 53, 53, 43, 53, 37, 33, 40, 33, 47, 47, 43, 37, 53, 43, 43, 57, 30, 40, 60, 57, 47, 30, 60, 30, 33, 33, 57, 53, 57, 43, 53, 50, 40, 50, 50, 30, 60, 57, 60, 37, 57, 50, 43, 43, 47, 60, 50, 60, 33, 43, 57, 43, 47, 33, 43, 33, 30, 47, 33, 37, 50, 30, 37, 47, 30, 30, 50, 47, 30, 43, 57, 37, 30, 37, 37, 57, 33, 33, 43, 30, 30, 57, 47, 33, 53, 57, 60, 40, 43, 57, 57, 50, 30, 50, 40, 30, 43, 53, 33, 53, 33, 50, 60, 40, 47, 43, 33, 47, 57, 50, 47, 60, 30, 47, 50, 50, 43, 50, 60, 47, 60, 53, 47, 30, 53, 53, 60, 57, 57, 30, 37, 43, 57, 37, 30, 30, 60, 43, 60, 30, 57, 30, 60, 53, 30, 47, 33, 50, 33, 40, 33, 37, 47, 40, 37, 60, 43, 57, 37, 53, 47, 40, 40, 40, 53, 37, 47, 47, 47, 43, 40, 33, 33, 30, 30, 40, 47, 53, 30, 43, 53, 30, 40, 33, 43, 50, 37, 57, 30, 47, 53, 33, 60, 37, 50, 30, 33, 43, 37, 33, 47, 43, 43, 60, 43, 60, 43, 57, 60, 57, 37, 60, 47, 30, 47, 30, 47, 53, 53, 60, 60, 50, 47, 60, 43, 33, 33, 53, 60, 37, 43, 40, 30, 33, 37, 33, 57, 50, 60, 57, 60, 33, 60, 30, 37, 43, 57, 37, 40, 30, 53, 53, 60, 57, 53, 37, 30, 57, 57, 30, 37, 50, 57, 53, 30, 40, 37, 53, 50, 37, 40, 37, 37, 40, 30, 53, 33, 60, 47, 40, 40, 60, 30, 53, 60, 57, 40, 43, 43, 47, 43, 30, 37, 40, 47, 43, 43, 37, 47, 33, 53, 33, 43, 43, 43, 60, 50, 53, 43, 30, 30, 53, 60, 33, 40, 40, 50, 40, 50, 43, 53, 40, 53, 43, 53, 60, 30, 47, 50, 60, 60, 30, 53, 40, 50, 50, 57, 43, 37, 57, 50, 57, 37, 50, 33, 57, 43, 50, 60, 43, 60, 30, 47, 43, 30, 40, 47, 33, 43, 40, 50, 57, 43, 33, 50, 47, 47, 47, 47, 60, 40, 57, 50, 53, 33, 43, 37, 47, 37, 50, 43, 57, 30, 60, 47, 47, 40, 50, 47, 53, 33, 53, 30, 33, 60, 60, 30, 47, 57, 57, 40, 33, 33, 47, 43, 53, 50, 60, 37, 43, 43, 47, 40, 37, 40, 43, 60, 40, 33, 47, 33, 40, 50, 30, 30, 47, 40, 30, 50, 40, 60, 57, 53, 50, 37, 60, 47, 43, 40, 50, 43, 57, 43, 33, 53, 47, 57, 40, 57, 53, 33, 40, 47, 47, 30, 43, 33, 37, 43, 37, 43, 30};
const int R3[] = {74, 89, 2, 16, 2, 103, 60, 60, 74, 45, 132, 103, 118, 103, 60, 74, 45, 16, 60, 103, 2, 74, 89, 45, 74, 2, 118, 16, 132, 89, 60, 31, 132, 118, 74, 89, 60, 60, 16, 2, 45, 103, 31, 89, 89, 31, 74, 132, 2, 31, 118, 2, 31, 45, 16, 132, 16, 74, 103, 89, 60, 2, 45, 118, 74, 74, 118, 2, 132, 2, 103, 89, 31, 16, 103, 132, 103, 31, 45, 60, 89, 45, 16, 74, 16, 103, 45, 31, 31, 103, 89, 74, 31, 60, 89, 45, 89, 60, 16, 60, 89, 74, 31, 89, 89, 31, 16, 60, 74, 60, 60, 31, 118, 16, 74, 60, 118, 16, 2, 60, 16, 45, 118, 132, 74, 2, 45, 2, 45, 74, 16, 2, 31, 103, 89, 31, 16, 16, 74, 31, 60, 118, 16, 118, 89, 31, 89, 103, 118, 31, 132, 2, 31, 2, 45, 60, 2, 2, 103, 118, 74, 31, 74, 2, 103, 31, 118, 89, 45, 31, 31, 74, 2, 89, 60, 60, 89, 118, 60, 74, 60, 2, 103, 132, 16, 118, 103, 103, 132, 118, 132, 31, 89, 74, 16, 45, 118, 132, 118, 2, 103, 16, 103, 16, 89, 2, 118, 2, 45, 31, 16, 118, 2, 45, 132, 60, 74, 60, 74, 31, 60, 132, 16, 118, 45, 31, 16, 103, 2, 132, 60, 103, 74, 103, 45, 89, 132, 132, 132, 118, 16, 74, 45, 132, 60, 132, 118, 2, 74, 132, 118, 103, 89, 60, 74, 103, 74, 2, 60, 132, 118, 89, 132, 103, 2, 45, 74, 16, 31, 103, 74, 16, 89, 89, 118, 118, 89, 2, 118, 74, 60, 45, 132, 74, 60, 16, 2, 60, 2, 16, 31, 118, 31, 74, 45, 89, 74, 16, 2, 60, 16, 60, 89, 103, 132, 60, 16, 45, 103, 132, 103, 103, 74, 45, 89, 74, 16, 60, 2, 31, 16, 2, 2, 16, 60, 103, 2, 103, 45, 60, 118, 132, 60, 31, 31, 74, 132, 31, 89, 45, 89, 132, 132, 2, 118, 89, 89, 60, 31, 103, 60, 45, 31, 45, 74, 60, 132, 89, 103, 74, 118, 89, 74, 74, 16, 118, 31, 74, 60, 16, 31, 16, 45, 45, 2, 103, 74, 45, 74, 31, 132, 103, 118, 2, 89, 31, 2, 74, 89, 2, 16, 74, 118, 118, 60, 74, 16, 132, 60, 2, 89, 74, 103, 132, 74, 2, 103, 2, 132, 2, 74, 103, 132, 103, 132, 118, 31, 74, 74, 74, 103, 103, 2, 103, 16, 103, 45, 60, 132, 89, 118, 60, 74, 31, 16, 60, 103, 89, 103, 60, 103, 60, 74, 31, 16, 89, 132, 103, 60, 2, 103, 16, 2, 60, 45, 132, 89, 74, 118, 2, 89, 16, 31, 132, 89, 118, 31, 45, 60, 31, 118, 60, 45, 89, 2, 118, 31, 31, 132, 60, 2, 132, 16, 89, 74, 74, 2, 16, 89, 103, 118, 103, 118, 103, 31, 45, 118, 16, 118, 103, 132, 118, 31, 118, 45, 103, 74, 45, 16, 60, 132, 2, 118, 132, 132, 2, 103, 89, 132, 103, 118, 60, 74, 60, 132, 74, 16, 16, 132, 74, 74, 103, 132, 2, 2, 16, 2, 2, 89, 74, 89, 2, 132, 89, 89, 2, 89, 118, 60, 31, 103, 45, 2, 16, 89, 132, 45, 31, 60, 45, 103, 31, 118, 132, 45, 45, 118, 118, 16, 45, 89, 31, 45, 118, 132, 103, 118, 2, 60, 89, 16, 16, 31, 89, 74, 60, 89, 103, 2, 118, 45, 60, 31, 16, 74, 2, 45, 74, 118, 132, 31, 45, 89, 74, 103, 103, 103, 31, 118, 45, 16, 132, 16, 45, 118, 45, 60, 132, 16, 74, 60, 16, 16, 60, 103, 118, 118, 89, 60, 60, 31, 45, 74, 89, 103, 31, 45, 2, 31, 16, 31, 118, 118, 45, 89, 16, 60, 45, 103, 60, 45, 89, 45, 132, 16, 60, 132, 16, 2, 103, 45, 2, 89, 103, 118, 45, 60, 16, 45, 89, 74, 103, 74, 16, 16, 2, 118, 132, 132, 16, 60, 16, 16, 103, 132, 103, 132, 45, 103, 31, 89, 45, 31, 103, 60, 118, 118, 103, 45, 45, 132, 132, 31, 118, 2, 132, 31, 60, 74, 74, 118, 118, 16, 45, 74, 103, 31, 60, 118, 31, 118, 2, 60, 118, 60, 74, 45, 103, 103, 45, 2, 16, 89, 45, 45, 31, 89, 16, 45, 118, 132, 45, 103, 31, 89, 2, 103, 31, 16, 103, 2, 2, 89, 31, 31, 118, 89, 31, 89, 2, 16, 103, 132, 132, 2, 45, 31, 74, 89, 60, 45, 45, 74, 132, 74, 74, 132, 45, 60, 89, 118, 31, 2, 45, 2, 132, 2, 118, 89, 31, 45, 45, 31, 45, 31, 31, 89, 45, 103, 89, 45, 74, 103, 132, 2, 60, 2, 89, 2, 2, 74, 45, 16, 74, 118, 103, 103, 89, 31, 103, 31, 118, 103, 2, 16, 103, 89, 118, 31, 132, 103, 60, 31, 16, 45, 89, 16, 60, 89, 60, 118, 16, 103, 74, 45, 60, 89, 118, 118, 132, 16, 118, 74, 45, 74, 103, 31, 74, 2, 118, 74, 2, 2, 45, 2, 2, 74, 132, 118, 89, 89, 31, 2, 89, 118, 132, 31, 16, 89, 103, 45, 31, 31, 31, 60, 31, 2, 74, 118, 132, 16, 45, 60, 2, 16, 16, 118, 132, 2, 16, 132, 118, 118, 45, 31, 45, 89, 60, 16, 60, 16, 103, 60, 132, 74, 16, 132, 89, 103, 89, 31, 45, 74, 16, 31, 2, 31, 103, 45, 16, 31, 132, 132, 16, 31, 132, 132, 60, 45, 132, 132, 74, 74, 118, 31, 2, 60, 132, 60, 16, 118, 2, 89, 60, 60, 2, 16, 16, 2, 89, 74, 74, 132, 132, 89, 60, 45, 132, 60, 31, 45, 74, 132, 132, 31, 103, 16, 89, 118, 132, 118, 132, 2, 74, 60, 45, 45, 118, 45, 16, 60, 132, 132};
const int R4[] = {21, 21, 15, 41, 35, 48, 21, 15, 61, 48, 61, 21, 68, 21, 61, 35, 8, 8, 15, 41, 21, 28, 48, 28, 68, 35, 41, 21, 35, 15, 15, 28, 28, 8, 21, 21, 8, 68, 15, 8, 61, 68, 21, 61, 55, 8, 55, 28, 41, 41, 68, 28, 21, 28, 35, 68, 15, 15, 35, 55, 41, 8, 48, 61, 21, 61, 28, 28, 8, 61, 61, 35, 8, 61, 48, 68, 61, 61, 48, 61, 28, 61, 21, 61, 41, 15, 8, 61, 35, 55, 55, 28, 68, 55, 15, 61, 61, 35, 35, 61, 61, 68, 41, 8, 15, 48, 55, 8, 28, 48, 28, 28, 68, 55, 41, 55, 15, 35, 35, 68, 55, 55, 48, 35, 61, 61, 55, 28, 35, 48, 15, 15, 8, 68, 35, 48, 68, 15, 41, 35, 48, 55, 35, 15, 68, 35, 15, 28, 68, 61, 8, 35, 55, 48, 41, 8, 28, 61, 61, 48, 21, 41, 61, 21, 21, 55, 55, 15, 15, 8, 41, 55, 8, 35, 68, 61, 8, 21, 48, 15, 21, 35, 8, 61, 48, 68, 28, 8, 21, 28, 35, 68, 68, 15, 8, 35, 55, 61, 8, 15, 48, 28, 61, 61, 61, 8, 15, 61, 55, 68, 35, 15, 8, 28, 8, 55, 28, 21, 68, 21, 48, 41, 68, 55, 8, 48, 15, 61, 48, 35, 15, 61, 28, 48, 15, 68, 35, 41, 61, 68, 28, 55, 68, 41, 68, 48, 35, 68, 15, 15, 48, 35, 41, 41, 28, 21, 15, 61, 48, 8, 48, 68, 68, 15, 41, 68, 35, 21, 55, 35, 61, 8, 21, 61, 21, 35, 55, 61, 28, 8, 35, 21, 48, 35, 41, 35, 68, 35, 41, 35, 21, 35, 28, 35, 55, 55, 48, 48, 28, 35, 68, 41, 21, 15, 35, 28, 61, 21, 68, 48, 28, 8, 55, 61, 28, 15, 21, 15, 21, 68, 28, 28, 48, 61, 55, 21, 8, 28, 68, 35, 48, 28, 68, 61, 61, 41, 8, 8, 35, 8, 68, 68, 41, 55, 55, 41, 15, 61, 68, 55, 61, 8, 48, 68, 21, 68, 41, 48, 15, 8, 41, 48, 68, 48, 55, 15, 28, 8, 48, 41, 41, 28, 41, 28, 41, 28, 68, 35, 48, 35, 55, 68, 21, 61, 8, 28, 68, 68, 8, 55, 28, 28, 48, 21, 8, 55, 55, 55, 21, 55, 41, 15, 55, 28, 21, 28, 21, 35, 35, 55, 55, 55, 61, 8, 68, 55, 15, 41, 68, 55, 68, 68, 15, 55, 55, 28, 28, 21, 21, 48, 28, 68, 8, 8, 15, 55, 41, 35, 8, 28, 8, 21, 35, 8, 35, 48, 15, 35, 8, 68, 15, 68, 48, 21, 28, 28, 35, 8, 15, 15, 41, 8, 68, 35, 41, 35, 41, 41, 35, 61, 61, 21, 28, 41, 15, 61, 68, 8, 21, 8, 61, 21, 28, 55, 35, 15, 35, 8, 48, 35, 41, 68, 48, 61, 21, 15, 68, 61, 48, 48, 55, 8, 15, 55, 41, 41, 48, 61, 41, 41, 15, 8, 8, 15, 68, 55, 15, 28, 28, 55, 41, 15, 8, 41, 21, 21, 55, 41, 48, 28, 55, 35, 35, 68, 48, 41, 8, 35, 55, 8, 68, 28, 41, 28, 8, 8, 61, 21, 35, 41, 28, 15, 48, 8, 55, 61, 35, 8, 21, 55, 48, 35, 55, 15, 28, 8, 35, 21, 21, 28, 48, 41, 15, 35, 21, 21, 41, 21, 21, 48, 8, 48, 28, 21, 8, 41, 28, 61, 41, 21, 61, 68, 48, 15, 61, 8, 35, 41, 21, 55, 15, 8, 28, 28, 28, 41, 35, 48, 35, 35, 68, 35, 28, 48, 8, 61, 28, 21, 8, 28, 55, 61, 61, 35, 68, 48, 28, 55, 28, 61, 41, 28, 21, 15, 41, 61, 15, 61, 21, 41, 35, 35, 55, 68, 48, 8, 28, 8, 8, 8, 41, 48, 55, 61, 48, 35, 41, 61, 41, 61, 48, 21, 21, 68, 28, 15, 55, 68, 55, 61, 35, 15, 8, 41, 15, 55, 28, 15, 55, 48, 48, 55, 21, 55, 61, 35, 48, 41, 41, 48, 68, 55, 68, 55, 28, 41, 61, 8, 35, 68, 48, 8, 55, 61, 21, 41, 15, 61, 68, 61, 55, 35, 21, 48, 48, 41, 15, 8, 8, 55, 15, 41, 28, 61, 68, 68, 21, 21, 55, 21, 28, 61, 41, 48, 68, 61, 41, 48, 35, 28, 68, 15, 68, 28, 28, 21, 41, 15, 68, 48, 21, 55, 8, 41, 35, 8, 21, 28, 15, 68, 48, 35, 68, 28, 68, 48, 35, 35, 61, 15, 21, 15, 41, 8, 48, 48, 55, 41, 15, 68, 41, 55, 55, 21, 21, 48, 41, 48, 28, 28, 8, 68, 21, 61, 15, 15, 55, 35, 55, 21, 41, 41, 15, 68, 68, 15, 68, 15, 15, 61, 61, 55, 48, 15, 61, 41, 48, 21, 48, 61, 35, 41, 35, 48, 55, 28, 28, 21, 21, 21, 28, 8, 68, 35, 21, 61, 15, 55, 41, 28, 68, 28, 41, 21, 21, 41, 35, 28, 61, 8, 55, 68, 55, 41, 61, 8, 55, 41, 35, 68, 55, 28, 68, 21, 15, 48, 35, 15, 28, 68, 21, 55, 55, 61, 8, 28, 15, 68, 15, 21, 68, 15, 35, 48, 61, 68, 21, 15, 41, 41, 15, 35, 35, 35, 68, 48, 41, 48, 48, 41, 15, 21, 61, 41, 28, 68, 35, 48, 28, 61, 41, 15, 48, 21, 48, 21, 8, 8, 48, 28, 21, 15, 41, 35, 61, 48, 8, 48, 21, 8, 55, 21, 55, 21, 55, 28, 15, 48, 61, 28, 15, 21, 41, 8, 61, 41, 8, 61, 68, 61, 61, 15, 41, 15, 41, 41, 48, 28, 15, 35, 8, 35, 48, 55, 68, 41, 48, 55, 55, 48, 48, 68, 61, 68, 21, 21, 68, 35, 35, 55, 15, 41, 55, 48, 28, 55, 61, 15, 8, 21, 55, 8, 48};

int minr1, minr2, minr3, minr4;
int a = 0;
int state = 0;
int num_motor = 0;
int num_step = 0;
int t = 0;
int r1, r2, r3, r4;
const int k = 25;

void reverse(int x, int y)
{
  int mind = 10000;
  for (int i = 0; i < 1001; i++)
  {

    float d = sqrt(pow(X[i] - x, 2) + pow(Y[i] - y, 2));

    if (d < mind)
    {
      mind = d;
      minr2 = R2[i];
      minr3 = R3[i];
      minr4 = R4[i];
    }


  }
}

void Stepper1_stop()
{
  digitalWrite(44, 0);
  digitalWrite(42, 0);
  digitalWrite(40, 0);
  digitalWrite(38, 0);
}
void Stepper2_stop()
{
  digitalWrite(52, 0);
  digitalWrite(50, 0);
  digitalWrite(48, 0);
  digitalWrite(46, 0);
}
void Stepper3_stop()
{
  digitalWrite(45, 0);
  digitalWrite(43, 0);
  digitalWrite(41, 0);
  digitalWrite(39, 0);
}
void Stepper4_stop()
{
  digitalWrite(53, 0);
  digitalWrite(51, 0);
  digitalWrite(49, 0);
  digitalWrite(47, 0);
}

void s_println(int n_args, ...)
{
  va_list ap;
  va_start(ap, n_args);
  for (int i = 1; i < n_args; i++)
  {
    s_print(va_arg(ap, int));
    s_print(", ");
  }
  s_print(va_arg(ap, int));
  s_print("\n");
  va_end(ap);
}

void set()
{
  analogWrite(2, 255);
  analogWrite(3, 255);
  analogWrite(4, 255);
  analogWrite(5, 255);
  analogWrite(6, 255);
  analogWrite(7, 255);
  analogWrite(8, 255);
  analogWrite(9, 255);

  digitalWrite(FAN1, 1);
  digitalWrite(LIGHT, 1);
  digitalWrite(VACUUM, 1);
}

void Stepper1_go(int pos)
{

  if (pos != r2)
  {
    myStepper1.step((pos - r2)*k);
  }
  Stepper1_stop();
  r1 = pos;
}

void Stepper2_go(int pos)
{
  if (pos < 190) pos = 190;
  if (pos > 260) pos = 260;
  if (pos != r2)
  {
    myStepper2.step(-(pos - r2)*k);
  }
  Stepper2_stop();
  r2 = pos;
}

void Stepper3_go(int pos)
{
  if (pos < 225) pos = 225;
  if (pos > 355) pos = 355;
  if (pos != r3)
  {
    myStepper3.step(-(pos - r3)*k);
  }
  Stepper3_stop();
  r3 = pos;
}

void Stepper4_go(int pos)
{
  if (pos < 200) pos = 200;
  if (pos > 270) pos = 270;
  if (pos != r4)
  {
    myStepper4.step((pos - r4)*k);
  }
  Stepper4_stop();
  r4 = pos;
}

void initialization()
{
  r2 = 260;
  myStepper2.step(-1500);
  Stepper2_go(253);

  r3 = 355;
  myStepper3.step(-3300);
  Stepper3_go(342);

  r4 = 270;
  myStepper4.step(1700);
  Stepper4_go(263);

  servo.write(0);


}

void setup()
{
  myStepper1.setSpeed(60);
  myStepper2.setSpeed(60);
  myStepper3.setSpeed(60);
  myStepper4.setSpeed(60);

  s_begin(9600);
  servo.attach(10);
}

void loop()
{
  set();

  switch (state)
  {
    case INIT:
      initialization();
      state = WORK;
      break;

    case WORK:
      if (s_is_av())
      {
        int x, y, a;
        a = s_to_int();
        if (t++ % 2 == 0)
        {
          x = a;
        }
        else
        {
          y = a;
          s_println(3, 666, x, y);
          reverse(x, y);
          Stepper3_go(355);
          Stepper2_go(minr2);
          Stepper3_go(minr3);
          Stepper4_go(minr4);
          t = 0;
        }
      }

  }
}
